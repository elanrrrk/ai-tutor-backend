<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –ú–µ–Ω—Ç–æ—Ä: –ë–∏–∑–Ω–µ—Å-–ê–Ω–∞–ª–∏–∑</title>
    <style>
        body { font-family: 'Helvetica Neue', sans-serif; background: #f0f2f5; color: #333; display: flex; justify-content: center; padding-top: 50px; }
        .container { width: 100%; max-width: 800px; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        label { font-weight: 600; display: block; margin-bottom: 8px; color: #444; }
        select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        textarea { height: 200px; resize: vertical; font-family: monospace; }
        
        .task-box { background: #e8f4fd; padding: 20px; border-radius: 8px; border-left: 5px solid #2196F3; margin-bottom: 25px; line-height: 1.6; }
        
        button { background: #2196F3; color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.2s; }
        button:hover { background: #1976D2; }
        button:disabled { background: #b0bec5; }
        
        #result { margin-top: 30px; padding: 25px; background: #fff; border: 1px solid #e0e0e0; border-radius: 12px; display: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="container">
    <h1>üíº –¢—Ä–µ–Ω–∞–∂–µ—Ä –ë–∏–∑–Ω–µ—Å-–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>

    <div class="form-group">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å:</label>
        <select id="caseSelector" onchange="loadCase()">
            <option value="ba_req_shop">üõí –ö–µ–π—Å 1: –°–±–æ—Ä —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (E-commerce)</option>
            <option value="ba_process_hr">‚ö° –ö–µ–π—Å 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (HR)</option>
        </select>
    </div>

    <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è -->
    <div id="taskDisplay" class="task-box"></div>

    <div class="form-group">
        <label>–í–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ:</label>
        <textarea id="solution" placeholder="1. User Stories...&#10;2. Non-functional...&#10;3. Criteria..."></textarea>
    </div>
    
    <div class="form-group">
        <label>–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª (.txt, .md, .csv):</label>
        <input type="file" id="fileInput">
    </div>

    <button id="btn" onclick="checkSolution()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>

    <div id="result"></div>
</div>

<script>
    // –¢–µ–∫—Å—Ç—ã –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    // (–û–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å –ø–æ —Å–º—ã—Å–ª—É —Å —Ç–µ–º, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö)
    const TASKS = {
        "ba_req_shop": `
            <b>–°–∏—Ç—É–∞—Ü–∏—è:</b> –í–ª–∞–¥–µ–ª–µ—Ü —Å–µ—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–µ–π —Ö–æ—á–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω.
            <br><br>
            <b>–ò–Ω—Ç–µ—Ä–≤—å—é —Å –∑–∞–∫–∞–∑—á–∏–∫–æ–º:</b> "–ù—É–∂–µ–Ω —Å–∞–π—Ç, —á—Ç–æ–±—ã –≤–±–∏–ª –Ω–æ–º–µ—Ä –¥–µ—Ç–∞–ª–∏ –∏ –∫—É–ø–∏–ª. –í–∞–∂–Ω–æ –≤–∏–¥–µ—Ç—å, –µ—Å—Ç—å –ª–∏ –¥–µ—Ç–∞–ª—å –≤ –•–∏–º–∫–∞—Ö –∏–ª–∏ –ú—ã—Ç–∏—â–∞—Ö. –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π. –ò —Å–º—Å–∫–∞ –º–Ω–µ –æ –∑–∞–∫–∞–∑–µ."
            <br><br>
            <b>–í–∞—à–∞ –∑–∞–¥–∞—á–∞:</b>
            1. –ù–∞–ø–∏—à–∏—Ç–µ 3 User Stories (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è).
            2. –£–∫–∞–∂–∏—Ç–µ 2 –Ω–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å/–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å).
            3. –û–ø–∏—à–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ (Acceptance Criteria) –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤.
        `,
        "ba_process_hr": `
            <b>–°–∏—Ç—É–∞—Ü–∏—è:</b> –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É, –Ω–æ –∂–¥–µ—Ç –Ω–æ—É—Ç–±—É–∫ –∏ –¥–æ—Å—Ç—É–ø—ã 5 –¥–Ω–µ–π. 
            –ü—Ä–æ—Ü–µ—Å—Å —Å–µ–π—á–∞—Å: –†–µ–∫—Ä—É—Ç–µ—Ä -> Email -> –°–∏—Å–∞–¥–º–∏–Ω -> Email -> –†–µ–∫—Ä—É—Ç–µ—Ä -> Email -> –ó–∞–≤—Ö–æ–∑ -> Excel -> –°–∫–ª–∞–¥.
            <br><br>
            <b>–í–∞—à–∞ –∑–∞–¥–∞—á–∞:</b>
            1. –í—ã–¥–µ–ª–∏—Ç–µ –≥–ª–∞–≤–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ (Bottlenecks).
            2. –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å TO-BE (–∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ).
            3. –ù–∞–∑–æ–≤–∏—Ç–µ –º–µ—Ç—Ä–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–ª—É—á—à–∞—Ç—Å—è –ø–æ—Å–ª–µ –≤–∞—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
        `
    };

    function loadCase() {
        const id = document.getElementById('caseSelector').value;
        document.getElementById('taskDisplay').innerHTML = TASKS[id];
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π –∫–µ–π—Å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadCase();

    async function checkSolution() {
        const btn = document.getElementById('btn');
        const resDiv = document.getElementById('result');
        const caseId = document.getElementById('caseSelector').value;
        
        let text = document.getElementById('solution').value;
        const fileInput = document.getElementById('fileInput');

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª, —á–∏—Ç–∞–µ–º –µ–≥–æ
        if (fileInput.files.length > 0) {
            try {
                text = await readFile(fileInput.files[0]);
            } catch (e) {
                return alert("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞");
            }
        }

        if (text.length < 10) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ.");

        // UI: –ó–∞–≥—Ä—É–∑–∫–∞
        btn.disabled = true;
        btn.innerText = "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ä–µ—à–µ–Ω–∏–µ...";
        resDiv.style.display = 'none';

        try {
            const req = await fetch('/api/check', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ case_id: caseId, solution: text })
            });
            
            const data = await req.json();
            
            // –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            resDiv.innerHTML = data.result
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // –ñ–∏—Ä–Ω—ã–π
                .replace(/\n/g, '<br>'); // –ü–µ—Ä–µ–Ω–æ—Å—ã
            
            resDiv.style.display = 'block';

        } catch (e) {
            alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: " + e.message);
        } finally {
            btn.disabled = false;
            btn.innerText = "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ";
        }
    }

    function readFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsText(file);
        });
    }
</script>

</body>
</html>
